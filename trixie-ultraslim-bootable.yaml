# A very minimal bootable Debian trixie image.
apiVersion: debco/v1alpha1
kind: Recipe

# Various options/flags to use when building the image.
options:
  # Don't automatically include priority required packages.
  omitRequired: true
  # Slimify the image by removing unnecessary files (ala debian-slim).
  slimify: true

# Where to get the packages from.
sources:
  - url: https://apt.immutos.com
    signedBy: https://apt.immutos.com/signing_key.asc
    distribution: trixie
    components:
      - testing
  - url: https://deb.debian.org/debian
    signedBy: https://ftp-master.debian.org/keys/archive-key-12.asc
    distribution: trixie
    components:
      - main

# The packages to include in the image.
packages:
  exclude:
    - libelogind0 # Until we've added support for detecting conflicts.
  include:
    - base-files
    - base-passwd
    - coreutils
    - ca-certificates
    - dash
    - diffutils
    - dpkg
    - findutils
    - grep
    - init-system-helpers
    - iputils-ping
    - libc6
    - libc-bin
    - libgcc-s1
    - libgomp1
    - libstdc++6
    - linux-image-6.10.9-qemu-immutos
    - login
    - matchstick
    - netbase
    - openssl
    - perl-base
    - sed
    - systemd
    - tzdata
    - udev
    - util-linux

# Create a distroless style nonroot user.
groups:
  - name: nonroot
    gid: 65532
users:
  - name: nonroot
    uid: 65532
    groups: 
      - nonroot

# Configuration for the OCI image.
container:
  user: root
  workingDir: /root
  cmd:
    - /sbin/init
  labels:
    org.opencontainers.image.title: "Debian Trixie UltraSlim Bootable"
    org.opencontainers.image.description: "A very minimal bootable Debian Trixie image"
    org.opencontainers.image.authors: "Damian Peckett <damian@pecke.tt>"
    org.opencontainers.image.source: "https://github.com/immutos/debco"
    org.opencontainers.image.ref.name: "registry.dpeckett.dev/debian:trixie-ultraslim-bootable"